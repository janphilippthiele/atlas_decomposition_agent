# File Patterns Configuration for Database Dependency Analysis
# This file defines file handling rules and processing constraints

# File extension to language mapping
file_mappings:
  # SQL files
  SQL:
    extensions:
      - .sql
      - .ddl    # Data Definition Language
      - .dml    # Data Manipulation Language
      - .dcl    # Data Control Language
    
    # Additional patterns to include files without standard extensions
    name_patterns:
      - "*_schema.txt"  # Schema definition files
      - "*.query"       # Query files
    
    # Priority when multiple languages match
    priority: 1
  
  # PL/SQL files
  PL/SQL:
    extensions:
      - .pls    # PL/SQL source
      - .plb    # PL/SQL body (wrapped)
      - .pks    # Package specification
      - .pkb    # Package body
      - .fnc    # Function
      - .prc    # Procedure
      - .trg    # Trigger
      - .typ    # Type definition
      - .tpb    # Type body
    
    name_patterns:
      - "*_pkg.*"      # Package files
      - "*_proc.*"     # Procedure files
      - "*_func.*"     # Function files
    
    priority: 2
  
  # XML configuration files
  XML:
    extensions:
      - .xml
      - .xsd       # XML Schema Definition
      - .config    # Configuration files
      - .cfg       # Alternative config extension
    
    name_patterns:
      - "*-config.xml"
      - "*-queries.xml"
      - "persistence.xml"
      - "database.xml"
      - "*-mapping.xml"
    
    # Only process XML files that likely contain database info
    content_patterns:
      - "datasource"
      - "jdbc"
      - "connection"
      - "query"
      - "table"
      - "column"
    
    priority: 3

# Directory and file exclusion patterns
exclusions:
  # Directories to skip
  directories:
    patterns:
      - "**/temp/**"
      - "**/tmp/**"
      - "**/backup/**"
      - "**/bak/**"
      - "**/.git/**"
      - "**/.svn/**"
      - "**/node_modules/**"
      - "**/target/**"
      - "**/build/**"
      - "**/dist/**"
      - "**/out/**"
      - "**/__pycache__/**"
      - "**/.idea/**"
      - "**/.vscode/**"
    
    # Specific directory names to exclude
    names:
      - "archive"
      - "archived"
      - "old"
      - "deprecated"
      - "test"
      - "tests"
      - "temp"
      - "temporary"
      - "backup"
      - "backups"
  
  # Files to skip
  files:
    patterns:
      - "*.bak"
      - "*.tmp"
      - "*.temp"
      - "*.log"
      - "*.swp"
      - "*.swo"
      - "*~"
      - "*.orig"
      - "#*#"        # Emacs temp files
      - ".#*"        # Emacs lock files
      - "*.pyc"
      - "*.pyo"
      - ".DS_Store"
    
    # Specific file name patterns
    name_patterns:
      - "backup_*"
      - "*_backup.*"
      - "*_bak.*"
      - "Copy of *"
      - "* - Copy.*"
      - "~$*"        # Windows temp files
      - "test_*"
      - "*_test.*"
      - "temp_*"
      - "*_temp.*"
    
    # Files generated by tools
    generated_markers:
      # If file contains these strings in first N lines, skip it
      in_header:
        - "AUTO-GENERATED"
        - "AUTOGENERATED"
        - "Generated by"
        - "This file is automatically generated"
        - "DO NOT EDIT"
        - "Machine generated"
      
      check_lines: 10  # Number of lines to check for markers

# Duplicate detection settings
duplicate_detection:
  # Enable/disable duplicate detection
  enabled: true
  
  # Similarity thresholds
  thresholds:
    # Exact match (same content)
    exact_match: 1.0
    
    # High similarity (likely duplicates)
    high_similarity: 0.95
    
    # Medium similarity (possible duplicates)
    medium_similarity: 0.85
    
    # Low similarity (probably related)
    low_similarity: 0.70
    
    # Below this threshold, files are considered different
    minimum_similarity: 0.50
  
  # Comparison methods
  methods:
    # Content hash comparison
    content_hash:
      enabled: true
      algorithm: "sha256"
    
    # Fuzzy string matching
    fuzzy_matching:
      enabled: true
      algorithm: "token_sort_ratio"  # From fuzzywuzzy
      
    # Structure comparison (for SQL)
    structure_comparison:
      enabled: true
      ignore_whitespace: true
      ignore_comments: true
      ignore_case: true
      normalize_names: true  # Normalize object names before comparison
  
  # What to do with duplicates
  handling:
    action: "report"  # Options: report, skip, merge
    keep: "newest"    # Options: newest, oldest, largest, manual
    
    # Group duplicates by these criteria
    group_by:
      - content_hash
      - object_definitions  # Group files defining same objects

# File processing constraints
processing_constraints:
  # Maximum file size to process
  file_size:
    max_size_mb: 50
    warning_size_mb: 20
    
    # Different limits by file type
    by_extension:
      .sql: 100
      .ddl: 100
      .xml: 25
      .pls: 75
      .plb: 50  # Wrapped files might be smaller
  
  # Processing limits
  limits:
    max_files_per_batch: 1000
    max_memory_per_file_mb: 100
    timeout_seconds_per_file: 300
    
    # Stop processing if these limits are reached
    global_limits:
      max_total_files: 1000000
      max_total_size_gb: 500
      max_processing_time_hours: 24

# Custom naming convention rules
naming_conventions:
  # Define expected naming patterns
  patterns:
    table:
      prefix: ["TBL_", "T_"]
      suffix: []
      pattern: "^[A-Z][A-Z0-9_]*$"  # Uppercase with underscores
      max_length: 30  # Oracle limit
    
    view:
      prefix: ["V_", "VW_"]
      suffix: ["_V", "_VIEW"]
      pattern: "^[A-Z][A-Z0-9_]*$"
      max_length: 30
    
    procedure:
      prefix: ["SP_", "P_", "PROC_"]
      suffix: ["_SP", "_PROC"]
      pattern: "^[A-Z][A-Z0-9_]*$"
      max_length: 30
    
    function:
      prefix: ["FN_", "F_", "FUNC_"]
      suffix: ["_FN", "_FUNC"]
      pattern: "^[A-Z][A-Z0-9_]*$"
      max_length: 30
    
    package:
      prefix: ["PKG_", "PACK_"]
      suffix: ["_PKG", "_PACK"]
      pattern: "^[A-Z][A-Z0-9_]*$"
      max_length: 30
    
    index:
      prefix: ["IX_", "IDX_", "I_"]
      suffix: []
      pattern: "^[A-Z][A-Z0-9_]*$"
      max_length: 30
    
    constraint:
      primary_key:
        prefix: ["PK_"]
        pattern: "^PK_[A-Z][A-Z0-9_]*$"
      
      foreign_key:
        prefix: ["FK_"]
        pattern: "^FK_[A-Z][A-Z0-9_]*$"
      
      unique:
        prefix: ["UK_", "UQ_"]
        pattern: "^U[KQ]_[A-Z][A-Z0-9_]*$"
      
      check:
        prefix: ["CK_", "CHK_"]
        pattern: "^C[HK]K?_[A-Z][A-Z0-9_]*$"
  
  # Validation settings
  validation:
    enabled: true
    strict_mode: false  # If true, fail on violations; if false, just warn
    
    # Exceptions (patterns to ignore)
    exceptions:
      - "SYS_*"     # System-generated names
      - "TEMP_*"    # Temporary objects
      - "TEST_*"    # Test objects
      - "BAK_*"     # Backup objects
    
    # Case sensitivity rules
    case_rules:
      sql_objects: "UPPERCASE"      # UPPERCASE, lowercase, CamelCase
      xml_elements: "lowercase"     # For XML parsing
      preserve_quoted: true         # Keep original case for quoted identifiers

# File organization detection
organization:
  # Detect project structure
  structure_patterns:
    # Schema-based organization
    schema_based:
      pattern: "*/{schema}/*.sql"
      example: "database/HR/tables.sql"
    
    # Object-type based organization
    type_based:
      pattern: "*/{object_type}/*.sql"
      example: "database/tables/employees.sql"
    
    # Module-based organization
    module_based:
      pattern: "*/{module}/{object_type}/*.sql"
      example: "modules/inventory/tables/products.sql"
    
    # Version-based organization
    version_based:
      pattern: "*/v{version}/*.sql"
      example: "releases/v2.1/schema_changes.sql"
  
  # How to group related files
  grouping:
    by_schema: true
    by_type: true
    by_module: true
    by_prefix: true  # Group files with same prefix

# Performance optimization settings
performance:
  # Parallel processing
  parallel:
    enabled: true
    max_workers: 8
    chunk_size: 100  # Files per chunk
  
  # Caching
  caching:
    enabled: true
    cache_parsed_results: true
    cache_ttl_hours: 24
    max_cache_size_mb: 1024
  
  # Progress reporting
  progress:
    show_progress_bar: true
    report_interval_seconds: 5
    detailed_logging: false